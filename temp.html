# certificates/services/sync.py
from certificates.models import Certificate
from certificates.services.adcs import fetch_certificates


def sync_certificates():
    certs = fetch_certificates()

    for cert in certs:
        Certificate.objects.update_or_create(
            serial_number=cert["serial_number"],
            defaults={
                "common_name": cert["common_name"],
                "issued_at": cert["issued_at"],
                "expires_at": cert["expires_at"],
                "template_name": cert["template_name"],
                "san": cert["san"],
            }
        )
