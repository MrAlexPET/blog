 sudo tee /etc/systemd/system/1. pglog-cleanup.service >/dev/null <<'EOF'
> [Unit]
> Description=Delete yesterday PostgreSQL csv logs
>
> [Service]
> Type=oneshot
> User=postgres
> ExecStart=/bin/bash -lc 'd=$(date -d "yesterday" +%F); rm -f /opt/log/pgpro/ent-16/pg_log/postgresql-${d}.csv*'
> EOF
root@db2-prod:/opt/log/pgpro/ent-16/pg_log# sudo tee /etc/systemd/system/pglog-cleanup.timer >/dev/null <<'EOF'
> [Unit]
> Description=Run pglog cleanup daily at 01:00
>
> [Timer]
> OnCalendar=*-*-* 01:00:00
> Persistent=true
>
> [Install]
> WantedBy=timers.target
> EOF
root@db2-prod:/opt/log/pgpro/ent-16/pg_log# sudo systemctl daemon-reload
root@db2-prod:/opt/log/pgpro/ent-16/pg_log# sudo systemctl enable --now pglog-cleanup.timer
Created symlink /etc/systemd/system/timers.target.wants/pglog-cleanup.timer â†’ /etc/systemd/system/pglog-cleanup.timer.
Job for pglog-cleanup.timer failed.
See "systemctl status pglog-cleanup.timer" and "journalctl -xe" for details.
root@db2-prod:/opt/log/pgpro/ent-16/pg_log# systemctl list-timers --all | grep pglog-cleanup || true
n/a                          n/a           n/a                          n/a          pglog-cleanup.timer           pglog-cleanup.service
