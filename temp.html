from pynput.mouse import Controller as MouseController, Button
from pynput.keyboard import Controller as KeyboardController, Key
import json

mouse = MouseController()
keyboard = KeyboardController()


def receive_commands(conn):
    while True:
        header = conn.recv(1)
        if not header:
            break

        packet_type = struct.unpack("B", header)[0]

        size_data = conn.recv(4)
        size = struct.unpack(">I", size_data)[0]

        data = conn.recv(size)
        message = json.loads(data.decode())

        if packet_type == 2:  # движение мыши
            mouse.position = (message["x"], message["y"])

        elif packet_type == 3:  # клик
            if message["action"] == "down":
                mouse.press(Button.left)
            else:
                mouse.release(Button.left)

        elif packet_type == 4:  # клавиша
            key = message["key"]
            keyboard.press(key)
            keyboard.release(key)



threading.Thread(target=receive_commands, args=(conn,), daemon=True).start()





алалалладв


import json

self.label.bind("<Motion>", self.on_mouse_move)
self.label.bind("<ButtonPress-1>", self.on_mouse_click)
self.label.bind("<ButtonRelease-1>", self.on_mouse_release)

self.root.bind("<KeyPress>", self.on_key_press)




def send_packet(self, packet_type, data_dict):
    data = json.dumps(data_dict).encode()
    self.sock.sendall(struct.pack("B", packet_type))
    self.sock.sendall(struct.pack(">I", len(data)))
    self.sock.sendall(data)


def on_mouse_move(self, event):
    self.send_packet(2, {"x": event.x, "y": event.y})


def on_mouse_click(self, event):
    self.send_packet(3, {"action": "down"})

def on_mouse_release(self, event):
    self.send_packet(3, {"action": "up"})



def on_key_press(self, event):
    self.send_packet(4, {"key": event.char})